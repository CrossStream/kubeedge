#!/usr/bin/make -f
# -*- makefile -*-
# ex: set tabstop=4 noexpandtab:
#{
# Copyright 2019 Samsung Electronics France SAS
#}
project?=kubeedge
sudo?=sudo

export USR_DIR?=/usr
default: rule/debuild
	@echo "#$@: $^"

export DH_VERBOSE = 1

%:
	dh $@

version?=$(shell [ -r debian/changelog ] \
  && which dpkg-parsechangelog > /dev/null 2>&1 \
  && dpkg-parsechangelog | grep "Version:" | sed -e "s/Version: \(.*\)-.*/\1/g" \
  || echo "0.0.0")

tarball?=${CURDIR}/../${project}_${version}.orig.tar.xz

${tarball}:
	 tar cvfJ "$@" \
--transform "s|^./|${project}-${version}/|" \
--exclude 'debian' \
--exclude-vcs \
.
	@ls -l $@

rule/tarball: ${tarball}
	@ls $^

rule/dist: rule/tarball
	sync

rule/version:
	@echo ${version}
	-cat /etc/os-release
	go version

rule/setup: /etc/debian_version
	${sudo} apt-get update -y
	${sudo} apt-get install -y \
  build-essential \
  devscripts \
  debhelper \
  fakeroot \
  git \
 #EOL

rule/debuild: debian/rules
	@which ${@F} || ${<D}/${<F} ${@D}/setup
	[ "" != "${tarball}" || ${<D}/${<F} ${@D}/tarball
	@ls ${tarball} || ${<D}/${<F} ${@D}/tarball
	${<D}/${<F} ${@D}/version
	${@F} -S -us -uc
	${@F} -us -uc
